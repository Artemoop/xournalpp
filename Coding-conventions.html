<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="img/favicon.ico">
        <title>Coding conventions - My Docs</title>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/font-awesome.min.css" rel="stylesheet">
        <link href="css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="js/jquery-1.10.2.min.js" defer></script>
        <script src="js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href=".">My Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="index.html" class="nav-link">Welcome to MkDocs</a>
                            </li>
                            <li class="navitem active">
                                <a href="Coding-conventions.html" class="nav-link">Coding conventions</a>
                            </li>
                            <li class="navitem">
                                <a href="Frequently-Asked-Questions-%26-Problem-Solving.html" class="nav-link">Frequently Asked Questions & Problem Solving</a>
                            </li>
                            <li class="navitem">
                                <a href="Git-Diff-Filter-for-Xournal.html" class="nav-link">Git Diff Filter for Xournal</a>
                            </li>
                            <li class="navitem">
                                <a href="Home.html" class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="How-to-provide-debug-info-for-input-related-bugs.html" class="nav-link">How to provide debug info for input related bugs</a>
                            </li>
                            <li class="navitem">
                                <a href="Installing.html" class="nav-link">Installing from source</a>
                            </li>
                            <li class="navitem">
                                <a href="Pen-eraser-button-issues.html" class="nav-link">Pen eraser button issues</a>
                            </li>
                            <li class="navitem">
                                <a href="User-Manual.html" class="nav-link">User Manual</a>
                            </li>
                            <li class="navitem">
                                <a href="_Sidebar_Install_instructions.html" class="nav-link">Build instructions</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="index.html" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="Frequently-Asked-Questions-%26-Problem-Solving.html" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#file-conventions" class="nav-link">File Conventions</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#code-formatting" class="nav-link">Code formatting</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#use-clang-format" class="nav-link">Use clang-format</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#indentation" class="nav-link">Indentation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#documentation" class="nav-link">Documentation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#includes" class="nav-link">Includes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#namespaces" class="nav-link">Namespaces</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#header-header" class="nav-link">Header header</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#naming-conventions" class="nav-link">Naming Conventions</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#general" class="nav-link">General</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#classes-structs-and-namespaces" class="nav-link">Classes, structs and namespaces</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#members-and-functions" class="nav-link">Members and Functions</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#overload-operators" class="nav-link">Overload operators</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#todo-comments" class="nav-link">TODO Comments</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#common-mistakes-please-avoid-them" class="nav-link">Common mistakes, please avoid them</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p>This wiki page describes the Coding Conventions of Xournal++, if you use an IDE, you may find a formatter configuration for your IDE in development/coding-conventions folder in main repo tree. If not, you may create one and push it.</p>
<h1 id="file-conventions">File Conventions</h1>
<p>The files are structured modular in subfolders. Each class consist of two files, a .cpp and a .h file (even if C++ is used, the files are always named .h, not .hpp).</p>
<p>If there is a small helper class (less than 100 lines of code) it may also be placed in the Parent class file.</p>
<p>The class- and filename have no prefix, so the filename and classname are the same.</p>
<p>File encoding is always UTF-8, without BOM.</p>
<p>To prevent including header files twice, each one should contain as first code line</p>
<pre><code class="cpp">#pragma once
</code></pre>

<p>All current compilers support this construct. This is the modern equivalent of</p>
<pre><code class="cpp">#ifndef MY_FILE_H 
#define MY_FILE_H
// some code
#endif
</code></pre>

<h1 id="code-formatting">Code formatting</h1>
<h2 id="use-clang-format">Use clang-format</h2>
<p><em>Currently we are using version 9. Check your usual installation options first then see the download area at https://llvm.org/  (note the Ubuntu Apt and Win sections).</em></p>
<p>Developers tend to use the automatic format functions of their IDE's, those aren't configured the same way other developers configured theirs, and they even differ between your own workstations.</p>
<p>Instead of letting the developers configure their format function, we provide a clang-format configuration file.
Clang-format is mostly IDE and platform independent, it is also supported by mostly every IDE.</p>
<p>This will reduce merge conflicts due different formatting.
We also don't accept PR's if the format of your changed files is wrong, 
so before a pull request, clang-format must be used.</p>
<p>We provide the .clang-format property file in the project root.
Clang-format is a platform and IDE independent tool from the LLVM Compiler Infrastructure project.
For further information take a look at https://clang.llvm.org/docs/ClangFormat.html</p>
<p>You can quickly reformat all your changed lines with:</p>
<p><code>git-clang-format-9 Commit_name_or_Hash</code>, make sure, your changes are staged and not committed.</p>
<p>Example:</p>
<p><code>git-clang-format-9 HEAD~6</code> will reformat only the changes made in the last 6 commits. </p>
<p><em>Note: You may need to specify the git-clang binary ( or link git-clang-8 to git-clang)</em></p>
<h2 id="indentation">Indentation</h2>
<ul>
<li>Spaces are used for indentation, indentation is 4 spaces.</li>
<li>Each if, for, while etc. are followed by curly braces, even if it only contains one line of code (because this is a common case for errors, e.g. search for "Apple goto fail bug")</li>
<li>if, for, while etc. are followed by a space, after the braced there is no space, e.g.</li>
</ul>
<pre><code class="cpp">if (a != b) {
    doSomething()
}
</code></pre>

<ul>
<li>return needs no braces, e.g.</li>
</ul>
<pre><code class="cpp">return a;
return a != b;
</code></pre>

<p><strong>not</strong></p>
<pre><code class="cpp">return (a);
return (a != b);
</code></pre>

<ul>
<li>
<p>Line width is 120 chars. The 80 char limit was historical for printing, printing is usually not used any more, and 120 Chars is even on small notebooks or tables readable, so it should be a good compromise.</p>
</li>
<li>
<p>Declare only one variable at once, don't do something like <code>int* x, y</code> (x is a pointer, y not)</p>
</li>
<li>Write the * of pointer to the type, e.g. <code>int* x</code>, not <code>int *x</code></li>
</ul>
<h2 id="documentation">Documentation</h2>
<ul>
<li>Use doxygen / javadoc compatible documentation tags, e.g.</li>
</ul>
<pre><code class="cpp">/**
 * Documentation of i
 */
int i;

</code></pre>

<ul>
<li>Add a space after <strong>//</strong> on single line comments, e.g. <code>// This is a comment</code></li>
</ul>
<h2 id="includes">Includes</h2>
<p>Includes should be sorted. General idea is that they should be sorted alphabetically in some groups (from the top):
- for <code>cpp</code> files corresponding <code>h</code> header
- std libraries
- external libraries (such as boost, glib, poppler, gtk)
- from other dirs absolute paths / Xournal++ utils
- local headers (from the same dir)</p>
<p>If there's long list, these groups should be divided with empty line:</p>
<pre><code class="cpp">#include &quot;Control.h&quot;

#include &lt;ctime&gt;
...
#include &lt;utility&gt;

#include &lt;boost/filesystem.hpp&gt;
#include &lt;boost/locale.hpp&gt;
#include &lt;gio/gio.h&gt;
#include &lt;glib/gstdio.h&gt;
#include &lt;gtk/gtk.h&gt;

#include &quot;gui/TextEditor.h&quot;
#include &quot;gui/XournalView.h&quot;
...
#include &quot;gui/toolbarMenubar/model/ToolbarData.h&quot;
#include &quot;gui/toolbarMenubar/model/ToolbarModel.h&quot;
#include &quot;jobs/AutosaveJob.h&quot;
#include &quot;jobs/BlockingJob.h&quot;
...
#include &quot;util/cpp14memory.h&quot;
#include &quot;view/DocumentView.h&quot;
#include &quot;view/TextView.h&quot;
#include &quot;xojfile/LoadHandler.h&quot;

#include &quot;CrashHandler.h&quot;
#include &quot;FullscreenHandler.h&quot;
#include &quot;LatexController.h&quot;
...
#include &quot;UndoRedoController.h&quot;
#include &quot;Util.h&quot;
#include &quot;XojMsgBox.h&quot;
#include &quot;config-dev.h&quot;
#include &quot;config-features.h&quot;
#include &quot;config.h&quot;
#include &quot;i18n.h&quot;

namespace fs = boost::filesystem;
using namespace std;
</code></pre>

<h2 id="namespaces">Namespaces</h2>
<p>using directives and declarations like <code>using namespace ns_name</code> and <code>using ns_name::name</code> are undesirable in headers. Same for namespace alias definitions.</p>
<h2 id="header-header">Header header</h2>
<p>Every header should start with general info comment:</p>
<pre><code class="cpp">/*
 * Xournal++
 *
 * [Header description]
 *
 * @author Xournal++ Team
 * https://github.com/xournalpp/xournalpp
 *
 * @license GNU GPLv2 or later
 */
</code></pre>

<h1 id="naming-conventions">Naming Conventions</h1>
<h2 id="general">General</h2>
<ul>
<li>Names are CamelCase (namespaces, classes, structs, enums, etc.)</li>
<li>Members are camelBack</li>
<li>Functions are camelBack</li>
<li>
<p>No underlines are used</p>
</li>
<li>
<p>Use short concise names - as short as possible as long as necessary
<strong> E.g. do not use unknown abbreviations like <code>int lnWidth</code>, which is not clear without context, but <code>int lineWidth</code> is clear.
</strong>Common short names should be used, e.g. <code>int dpi</code> is Ok, because it is well known.</p>
</li>
</ul>
<h2 id="classes-structs-and-namespaces">Classes, structs and namespaces</h2>
<p>shall not contain prefixes or suffixes, and are written CamelCase, starting with a <em>uppercase</em> letter</p>
<h2 id="members-and-functions">Members and Functions</h2>
<p>shall not contain prefixes or suffixes, and are written camelBack, starting with a <em>lowercase</em> letter</p>
<h2 id="overload-operators">Overload operators</h2>
<p>Please don't use overload operators to extensive. Overload "==", "=" etc. are OK and usual.
But don't do unexpected things.</p>
<h2 id="todo-comments">TODO Comments</h2>
<p>Try to avoid unclear TODO comments, e.g. <code>// TODO streams</code> is really unclear.</p>
<p>Always write your name or the name of the relevant persons behind the todo, eg. <code>// Todo (John Doe, Fred Doe) ...</code></p>
<p>If there is a TODO which really should be done write a sentence or two what should be done why.</p>
<p>Open an issue for Todo's.</p>
<h2 id="common-mistakes-please-avoid-them">Common mistakes, please avoid them</h2>
<h3 id="initialize-all-members">Initialize all members</h3>
<p>All constructors should initialize all members, even if not all are used. Initialize them in the body.
Use lambdas or inline/constexpr functions to initialize post evaluated variables.</p>
<h3 id="memory">Memory</h3>
<h4 id="avoid-to-allocate-objects-on-the-heap-especially-if-they-are-only-used-locally">Avoid to allocate objects on the heap, especially if they are only used locally.</h4>
<p>Using the heap is almost slower than using the stack you also don't need to be aware of memory leaks.
Only use the heap for big objects, objects with a dynamic size or if you have to expand the lifetime of an object. </p>
<h4 id="always-try-to-expand-the-lifetime-with-auto-const-or-auto-in-combination-with-copy-elision-first">Always try to expand the lifetime with "auto const&amp;" or "auto&amp;&amp;" in combination with copy elision first.</h4>
<h4 id="use-raii-containers-to-manage-memory-in-newly-written-code-like-stdunique_ptr-or-stdshared_ptr">Use RAII containers to manage memory in newly written code like <code>std::unique_ptr</code> or <code>std::shared_ptr</code>.</h4>
<p>Note: be very careful with pointers to objects from C library dependencies. For example, GLib/GTK implements its own reference counting mechanism and may not be compatible with STL smart pointers. Additionally, a object from a C library may require specific new/destroy method pairs for allocation and deallocation (e.g. <code>cairo_surface_create</code>/<code>cairo_surface_destroy</code>). For such objects, you will need to implement a custom deleter in order to use a STL smart pointer.</p>
<h4 id="dont-use-new-or-delete-anymore-because-humans-make-mistakes-and-forget-to-delete-their-objects">Don't use new or delete anymore, because humans make mistakes and forget to delete their objects.</h4>
<p>You'll also always get an memory leak, if a unexpected exception isn't catched in this scope.
Since dtor's are always called after leaving a scope, RAII memory container will call delete in his dtor even if an exception is thrown.</p>
<p>Examples: </p>
<p>Wrong:</p>
<pre><code class="cpp">{
    auto* ptr = new MySmalHelperObj();
    myFunMayThrow(); //Memory leak &amp; no call to ~MySmalHelperObj();
    /*...*/
    delete ptr; // Explicit call of ~MySmalHelperObj();
}
</code></pre>

<p>Right &amp; ok:</p>
<pre><code class="cpp">{
    auto helper_ptr = std::make_unique&lt;MySmalHelperObj&gt;(); //local Stack Object
    myFunMayThrow();
    /*...*/
} // Implicit call of ~std::unique_ptr&lt;MySmalHelperObj&gt;();
</code></pre>

<p>Right but better:</p>
<pre><code class="cpp">{
    auto helper = MySmalHelperObj(); //local Stack Object
    myFunMayThrow(); //No memory leak;
    /*...*/
} // Implicit call of ~MySmalHelperObj();
</code></pre>

<p>Wrong:</p>
<pre><code class="cpp">{
MyObj* getMyObject(){  
    auto* ptr = new MyObj();
    ptr-&gt;initMayThrow(); //memory leak
    return ptr;
}
</code></pre>

<p>Right &amp; OK:</p>
<pre><code class="cpp">{
std::unique_ptr&lt;MyObj&gt; getMyObject(){ //Additionally shows owner change
    auto ptr = std::make_unique&lt;MyObj&gt;();
    ptr-&gt;initMayThrow(); //no memory leak
    return ptr; // no move at an exception, automatic dtor call
}
</code></pre>

<p>Right but better:</p>
<pre><code class="cpp">{
MyObj getMyObject(){
    auto myobj = MyObj();
    myobj.initMayThrow(); //no memory leak, simple stack unwinding
    return myobj; // fast because of copy elision (no copy)
}

int main() {
    MyObj const&amp; myobj1 = getMyObject(); // Life time extension of temporary, legal, same as:
    MyObj const myobj2 = getMyObject(); // Copy elision,

    MyObj&amp;&amp; myobj3 = getMyObject(); // Non const lifetime extension of temporary, in this case same as:
    MyObj myobj3 = getMyObject(); // Copy elision, very fast
}
</code></pre>

<h4 id="set-pointer-to-nullptr-after-delete">Set pointer to <code>nullptr</code> after delete</h4>
<p>Since calling delete on a <code>nullptr</code> is valid, but calling it at a previously deleted pointer is undefined behaviour you should set the pointer to <code>nullptr</code>. Not doing this makes the search for errors difficult, because the application doesn't have to crash.</p>
<pre><code class="cpp">if (this-&gt;timer)
{
    delete this-&gt;timer; May call ctor twice -&gt; undefined
}
</code></pre>

<p>To avoid this, set the pointer to <code>nullptr</code>:</p>
<pre><code class="cpp">delete this-&gt;timer;
this-&gt;timer = NULL;
</code></pre>

<h3 id="using-auto-everywhere">Using auto everywhere</h3>
<p>While the <code>auto</code> type of C++ is very handy, developers tend to abuse it. C++ is a strongly typed language and hence by using this type the developer instructs the compiler to determine the type of the variable at compilation time.</p>
<p>This does not directly lead to problems, as the compiler is able to know about the correct type of the variable. The problems come along the way. Refactoring parts of the code may lead to bugs that occur in positions that should normally not be influenced by the changes. There may also occur bugs that fly by the compiler and won't even raise a warning but still cause problems during execution of the code.</p>
<p>To avoid these problems do only use the <code>auto</code> type when creating new objects using the following statement:</p>
<pre><code>auto pointer = new Object();
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = ".",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="js/base.js" defer></script>
        <script src="search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
